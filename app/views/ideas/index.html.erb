<%= render "layouts/pt_header" %>

<div class="container" id="ideas">

  <div class="row">
    <%= form_tag ideas_path, :method => "get", class: "input-group col-md-6 col-lg-6 col-md-offset-3" do %>
    <%= text_field_tag :search, params[:search],class: "form-control input-lg", placeholder: "Pesquisar Ideia" %>
    <%= content_tag(:span, submit_tag("Pesquisar", class: "btn btn-primary input-lg"), class:"input-group-btn") %>
    <% end %>
    <br>
  </div>

  <% if @ideas.size != 0 %>
  <div class="row">
    <div class="box">

      <div class="dropdown" style="float:right;">
        <button class="btn btn-default dropdown-toggle" data-toggle="dropdown" type="button">Ordenação
          <span class="caret"></span>
        </button>
        <ul class="dropdown-menu">
          <li>
            <%= link_to "Votos Crescente", ideas_path(:order => "crescente") %>
          </li>
          <li>
            <%= link_to "Votos Decrescente", ideas_path(:order => "decrescente")%>
          </li>
          <li>
            <%= link_to "Mais Recente", ideas_path(:order => "newer")%>
          </li>
          <li>
            <%= link_to "Mais Antiga", ideas_path(:order => "older")%>
          </li>
        </ul>
      </div>
      <div class="dropdown" style="float:right;">
        <button class="btn btn-default dropdown-toggle" data-toggle="dropdown" type="button">Categoria
          <span class="caret"></span>
        </button>
        <ul class="dropdown-menu">
          <% @topics.each do |topic| %>
          <li>
            <%= link_to topic.name, ideas_path(:order => "by_topic", :id_topic => topic.id)%>
          </li>
          <% end %>
        </ul>
      </div>

      <% @ideas.each do |idea| %>
      <div class="col-lg-12 text-center">
        <h2>[<%= idea.topic.name %>]
          <%= idea.title %><br>
          <small><%= idea.date.strftime("%B %d, %Y")  %></small>
        </h2>
        <div class="col-xs-12 col-sm-12 col-md-4">
          <% if idea.picture? %>
          <img class="img-responsive img-border img-full" src=<%=idea.picture.url%>
          >
          <% else %>
          <img class="img-responsive img-border img-full" src=<%=idea.topic.picture.url%>
          >
          <% end %>
        </div>
        <p><%= idea.text %></p>
        <div class="col-lg-12 inline text-center">
          <div id=voteButtons<%= idea.id %> class="btn-group btn-group-sm">
            <% if cookies[idea.id].blank? %>
            <%= button_to upvote_idea_path(idea), method: :post, remote: true, role:"button" ,class:"a btn btn-default" do%>
            <span aria-hidden="true" class="glyphicon glyphicon-thumbs-up">
              Gostei</span>
            <% end %>
            <%= button_to downvote_idea_path(idea), method: :post,remote: true, role:"button" , class:"a btn btn-default" do%>
            <span aria-hidden="true" class="glyphicon glyphicon-thumbs-down">
              Não gostei</span>
            <% end %>
            <% end %>
          </div>
          <table id="votes">
            <tr>
              <td>
                <h5>Votação:
                </h5>
              </td>
              <td class="upvote">
                <h4  id=upvote<%= idea.id %>>+<%= idea.upvotes %></h4>
              </td>
              <td class="downvote">
                <h4 id=downvote<%= idea.id %>>-<%= idea.downvotes %></h4>
              </td>
            </tr>
          </table>
          <hr>
        </div>
      </div>
      <% end %>
    </div>
  </div>
  <% end %>
</div>
